(($,l,f)=>{"use strict";!function(n,o,e){n.fn.tb_backstretch=function(i,s){return void 0!==s&&(void 0===s.mode&&(void 0!==o.themifyScript&&o.themifyScript.backgroundMode?s.mode=themifyScript.backgroundMode:void 0!==o.themifyVars&&o.themifyVars.backgroundMode&&(s.mode=themifyVars.backgroundMode)),void 0===s.position&&(void 0!==o.themifyScript&&o.themifyScript.backgroundPosition&&o.themifyScript.backgroundPosition?s.position=o.themifyScript.backgroundPosition:void 0!==o.themifyVars&&o.themifyVars.backgroundPosition&&o.themifyVars.backgroundPosition&&(s.position=o.themifyVars.backgroundPosition)),void 0===s.is_first)&&(s.is_first=!0),i!==e&&0!==i.length||n.error("No images were supplied for Backstretch"),0===n(o).scrollTop()&&o.scrollTo(0,0),this.each(function(){var t=n(this),e=t.data("tb_backstretch");if(e){if("string"==typeof i&&"function"==typeof e[i])return void e[i](s);s=n.extend(e.options,s),e.destroy(!0)}e=new r(this,i,s),t.data("tb_backstretch",e)})},n.tb_backstretch=function(t,e){return n("body").tb_backstretch(t,e).data("tb_backstretch")},n.expr.pseudos.tb_backstretch=function(t){return n(t).data("tb_backstretch")!==e},n.fn.tb_backstretch.defaults={centeredX:!0,centeredY:!0,duration:5e3,fade:0,mode:"",position:""};var a={left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},d={position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"auto",height:"auto",maxHeight:"none",maxWidth:"none",zIndex:-999999},r=function(t,e,i){for(var s in this.options=n.extend({},n.fn.tb_backstretch.defaults,i||{}),this.images=n.isArray(e)?e:[e],this.images)n("<img />")[0].src=void 0===this.images[s].url?this.images[s]:this.images[s].url;this.isBody=t===document.body,this.$container=n(t),this.$root=this.isBody?n(o):this.$container,t=this.$container.children(".tb_backstretch").first(),this.$wrap=t.length?t:n('<div class="tb_backstretch"></div>').css(a).appendTo(this.$container),this.isBody||(t=this.$container.css("position"),e=this.$container.css("zIndex"),this.$container.css({position:"static"===t?"relative":t,zIndex:"auto"===e?0:e,backgroundImage:"none"}),this.$wrap.css({zIndex:-999998})),this.$wrap.css({position:this.isBody?"fixed":"absolute"}),this.index=0,this.show(this.index,this.options.is_first),n(o).on("resize.tb_backstretch",n.proxy(this.resize,this)).on("orientationchange.tb_backstretch",n.proxy(function(){this.isBody&&0===o.pageYOffset&&(o.scrollTo(0,1),this.resize())},this))};r.prototype={resize(){try{var t,e={left:0,top:0},i=this.isBody?this.$root.width():this.$root.innerWidth(),s=i,a=this.isBody?o.innerHeight||this.$root.height():this.$root.innerHeight(),r=s/this.$img.data("ratio");"best-fit"===this.options.mode&&(s/a>parseFloat(this.$img.data("ratio"))?this.$img.addClass("best-fit-vertical").removeClass("best-fit-horizontal"):this.$img.addClass("best-fit-horizontal").removeClass("best-fit-vertical")),a<=r?(t=(r-a)/2,this.options.centeredY&&(e.top="-"+t+"px")):(t=((s=(r=a)*this.$img.data("ratio"))-i)/2,this.options.centeredX&&(e.left="-"+t+"px")),this.$wrap.css({width:i,height:a}).find("img:not(.deleteable)").css({width:s,height:r}).css(e)}catch(t){}return this},show(i,s){var t,a,r,o;if(!(Math.abs(i)>this.images.length-1))return r=(a=this).$wrap.find("img").addClass("deleteable"),o={relatedTarget:a.$container[0]},a.$container.trigger(n.Event("tb_backstretch.before",o),[a,i]),this.index=i,clearInterval(a.interval),a.$img=n("<img />").css(d).bind("load",function(t){var e=this.width||n(t.target).width();t=this.height||n(t.target).height(),n(this).data("ratio",e/t),void 0!==a&&("best-fit"===a.options.mode?(n(this).parent().addClass("best-fit-wrap"),e=e/t,a.$wrap.width()/a.$wrap.height()>e?n(this).addClass("best-fit best-fit-vertical"):n(this).addClass("best-fit best-fit-horizontal")):"fullcover"===a.options.mode&&a.options.position?n(this).addClass("fullcover-"+a.options.position):"kenburns-effect"===a.options.mode&&n(this).parent().addClass("kenburns-effect"),s)&&n(this).show(),n(this).fadeIn(a.options.speed||a.options.fade,function(){r.remove(),a.paused||a.cycle(),n(["after","show"]).each(function(){a.$container.trigger(n.Event("tb_backstretch."+this,o),[a,i])})}),a.resize()}).appendTo(a.$wrap),void 0===a.images[i].url?t=a.images[i]:(t=a.images[i].url,a.images[i].alt&&a.$img.attr("alt",a.images[i].alt)),a.$img.attr("src",t),a},next(){return this.show(this.index<this.images.length-1?this.index+1:0,!1)},prev(){return this.show(0===this.index?this.images.length-1:this.index-1,!1)},pause(){return this.paused=!0,this},resume(){return this.paused=!1,this.next(),this},cycle(){return 1<this.images.length&&(clearInterval(this.interval),this.interval=setInterval(n.proxy(function(){this.paused||this.next()},this),this.options.duration)),this},destroy(t){n(o).off("resize.tb_backstretch orientationchange.tb_backstretch"),clearInterval(this.interval),t||this.$wrap.remove(),this.$container.removeData("tb_backstretch")}}}(jQuery,window),f.autoplay=f.backgroundSlider?.autoplay?parseInt(f.backgroundSlider.autoplay,10):5e3;l.on("builder_load_module_partial",(t,e)=>{let i;if(!0===e){if("DIV"!==t.tagName||t.classList.contains("module"))return;const s=t.querySelector(":scope>.tb_slider");if(null===s)return;i=[s]}else i=l.selectWithParent("tb_slider",t);0<i.length&&l.loadCss(ThemifyBuilderModuleJs.cssUrl+"backgroundSlider").then(()=>{(h=>{f.autoplay<=10&&(f.autoplay*=1e3);for(let d=h.length-1;-1<d;--d){let t=h[d],e=$(t),r=e.parent(),i=t.tfTag("li"),o=[];for(var c=i.length-1;-1<c;--c)o.push({url:i[c].dataset.bg,alt:i[c].dataset.bgAlt});r.tb_backstretch(o,{speed:parseInt(t.dataset.sliderspeed),duration:f.autoplay,mode:t.dataset.bgmode});let s=r.data("tb_backstretch"),a=e.find(".row-slider-slides > li"),n="row-slider-dot-active";for(c=(i=t.querySelectorAll(".row-slider-prev,.row-slider-next,.row-slider-dot")).length-1;-1<c;--c)i[c].tfOn("click",function(t){this.classList.contains("row-slider-dot")?s.show($(this).data("index")):(t.preventDefault(),this.classList.contains("row-slider-prev")?s.prev():s.next())},{passive:i[c].classList.contains("row-slider-dot")});if(a[0]&&(a[0].classList.add(n),r.on("tb_backstretch.show",(t,e)=>{const i=a.eq(s.index);i[0]&&(a.removeClass(n),i.addClass(n))})),"kenburns-effect"===t.dataset.bgmode){let s,t=0,e=4<o.length?4:o.length,a=()=>t+1>e?t=1:++t;r.on("tb_backstretch.before",(t,e)=>{setTimeout(()=>{if(s!=e.index){const t=e.$wrap.find("img").last();t.addClass("kenburns-effect"+a()),s=e.index}},50)}).on("tb_backstretch.after",(t,e)=>{const i=e.$wrap.find("img").last();/kenburns-effect\d/.test(i.attr("class"))||(i.addClass("kenburns-effect"+a()),s=e.index)}),l.is_builder_active&&r.on("backstretch.show",(t,e,i)=>{r.css("zIndex",0)})}}})(i)})})})(jQuery,Themify,tbLocalScript);